<div class="seguimiento-page">

    <!-- Header -->
    <div class="page-header">
      <h2>Seguimiento</h2>
    </div>
  
    <!-- Tabs -->
    <div class="tabs">
      <button class="tab" [class.active]="activeTab === 'followers'" (click)="activeTab = 'followers'; searchTerm = ''">
        Te siguen
        <span class="tab-count" *ngIf="followers.length > 0">{{ followers.length }}</span>
      </button>
      <button class="tab" [class.active]="activeTab === 'following'" (click)="activeTab = 'following'; searchTerm = ''">
        Sigues tÃº
        <span class="tab-count" *ngIf="following.length > 0">{{ following.length }}</span>
      </button>
    </div>
  
    <!-- Filtro -->
    <div class="search-bar" *ngIf="(activeTab === 'followers' ? followers : following).length > 0">
      <span class="search-icon">ğŸ”</span>
      <input type="text" [(ngModel)]="searchTerm"
        [placeholder]="activeTab === 'followers' ? 'Filtrar seguidores...' : 'Filtrar siguiendo...'"
        maxlength="50" />
      <button class="clear-btn" *ngIf="searchTerm" (click)="searchTerm = ''">âœ•</button>
    </div>
  
    <!-- Loading -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
    </div>
  
    <!-- â”€â”€ PESTAÃ‘A: TE SIGUEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <ng-container *ngIf="!loading && activeTab === 'followers'">
  
      <div class="empty-state" *ngIf="followers.length === 0">
        <span class="empty-icon">ğŸ‘¥</span>
        <p>TodavÃ­a nadie te sigue</p>
        <small>Cuando alguien te siga, aparecerÃ¡ aquÃ­</small>
      </div>
  
      <div class="empty-state" *ngIf="followers.length > 0 && filteredFollowers.length === 0">
        <span class="empty-icon">ğŸ”</span>
        <p>NingÃºn seguidor coincide con "{{ searchTerm }}"</p>
      </div>
  
      <div class="user-list">
        <div class="user-row" *ngFor="let entry of filteredFollowers"
          [class.in-progress]="entry.inProgress"
          (click)="goToProfile(entry.user.username)">
  
          <img class="user-avatar"
            [src]="entry.user.avatarUrl || 'assets/default-avatar.png'"
            [alt]="entry.user.displayName" />
  
          <div class="user-info">
            <div class="user-name-row">
              <span class="user-name">{{ entry.user.displayName }}</span>
              <span class="mutual-badge" *ngIf="isFollowingUser(entry.user.uid)">â†” Mutuo</span>
            </div>
            <span class="user-username">&#64;{{ entry.user.username }}</span>
            <span class="user-bio" *ngIf="entry.user.bio">{{ entry.user.bio | slice:0:80 }}{{ (entry.user.bio?.length || 0) > 80 ? '...' : '' }}</span>
            <span class="user-stats">{{ entry.user.followersCount || 0 }} seguidores</span>
          </div>
  
          <div class="user-actions" (click)="$event.stopPropagation()">
            <!-- Seguir de vuelta / Dejar de seguir -->
            <button class="btn-follow" [class.following]="isFollowingUser(entry.user.uid)"
              [disabled]="entry.inProgress"
              (click)="toggleFollow(entry, $event)">
              <span *ngIf="!entry.inProgress">{{ isFollowingUser(entry.user.uid) ? 'Siguiendo' : 'Seguir' }}</span>
              <span *ngIf="entry.inProgress" class="mini-spinner"></span>
            </button>
            <!-- Eliminar seguidor -->
            <button class="btn-remove" [disabled]="entry.inProgress"
              (click)="removeFollower(entry, $event)" title="Eliminar seguidor">
              âœ•
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  
    <!-- â”€â”€ PESTAÃ‘A: SIGUES TÃš â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <ng-container *ngIf="!loading && activeTab === 'following'">
  
      <div class="empty-state" *ngIf="following.length === 0">
        <span class="empty-icon">ğŸ”­</span>
        <p>No sigues a nadie todavÃ­a</p>
        <small>Explora la app y empieza a seguir personas</small>
      </div>
  
      <div class="empty-state" *ngIf="following.length > 0 && filteredFollowing.length === 0">
        <span class="empty-icon">ğŸ”</span>
        <p>Nadie coincide con "{{ searchTerm }}"</p>
      </div>
  
      <div class="user-list">
        <div class="user-row" *ngFor="let entry of filteredFollowing"
          [class.in-progress]="entry.inProgress"
          (click)="goToProfile(entry.user.username)">
  
          <img class="user-avatar"
            [src]="entry.user.avatarUrl || 'assets/default-avatar.png'"
            [alt]="entry.user.displayName" />
  
          <div class="user-info">
            <div class="user-name-row">
              <span class="user-name">{{ entry.user.displayName }}</span>
              <!-- Si tambiÃ©n nos sigue a nosotros -->
              <span class="mutual-badge" *ngIf="entry.user.following?.includes(currentUser?.uid || '')">â†” Mutuo</span>
            </div>
            <span class="user-username">&#64;{{ entry.user.username }}</span>
            <span class="user-bio" *ngIf="entry.user.bio">{{ entry.user.bio | slice:0:80 }}{{ (entry.user.bio?.length || 0) > 80 ? '...' : '' }}</span>
            <span class="user-stats">{{ entry.user.followersCount || 0 }} seguidores</span>
          </div>
  
          <div class="user-actions" (click)="$event.stopPropagation()">
            <button class="btn-follow following" [disabled]="entry.inProgress"
              (click)="unfollowUser(entry, $event)">
              <span *ngIf="!entry.inProgress">Siguiendo</span>
              <span *ngIf="entry.inProgress" class="mini-spinner"></span>
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  
  </div>